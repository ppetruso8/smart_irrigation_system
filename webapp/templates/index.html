{% extends "base.html" %}

{% block main_content %}
    <h1>Dashboard</h1>
    <section id = "sensors">
        <h2>Sensors</h2>
        <section id="sensors_container">
            {% for sensor in sensors %}
            <section class = "sensor">
                <h3>Sensor {{ sensor.sensor_no }}</h3>
                <p>Soil Moisture: {{ sensor.moisture }}</p>
                <p>Temperature: {{ sensor.temperature }} °C</p>
                <p>Humidity: {{ sensor.humidity }} %</p>
                <p>Brightness: {{ sensor.brightness }}</p>

                <div class="sensor_buttons">
                    <button onclick="refresh()">Update</button>
                    <button onclick="pump('on')">Manual Watering</button>
                </div>

                <h4>Settings</h4>
                <form action="" method="POST" novalidate>
                    {{ forms[sensor.sensor_no].hidden_tag() }}
                    <input type="hidden" name="sensor" value="{{ sensor.sensor_no }}">
                    
                    {{ forms[sensor.sensor_no].pump.label }}
                    {{ forms[sensor.sensor_no].pump }}
                    </br>
                    {{ forms[sensor.sensor_no].env.label }}
                    {{ forms[sensor.sensor_no].env() }}
                    </br>
                    {{ forms[sensor.sensor_no].mode.label }}
                    {{ forms[sensor.sensor_no].mode() }}
                    </br>
                    <div class="submit_button">
                        {{ forms[sensor.sensor_no].submit() }}
                    </div>
                </form>
                <!-- <p>Pump: {{ sensor.pump }}</p>
                <p>Sensor: {{ sensor.sensor_no }}</p>
                <p>Environment: {{ sensor.env }}</p>
                <p>Watering Mode: {{ sensor.mode }}</p> -->
                
            </section>
            {% endfor %}
        </section>
    </section>

    <section id = "weather">
        <h2>Weather</h2>
        <section id="location">
            <form action="" method="POST" novalidate>
                <div>
                {{ location_form.hidden_tag() }}
                {{ location_form.location.label }}
                {{ location_form.location() }}
                </div>
                <div>
                {{ location_form.submit() }}
                </div>
            </form>   
        </section>

        <section id="current_weather">
            <h3>Current Weather</h3>
        
            <div class="weather_item">
                <p class="weather_icon" >🌡</p>
                <p>Temperature</p>
                <p>{{ weather.temperature }}°C</p>
            </div>
        
            <div class="weather_item">
                <p class="weather_icon">🌥</p>
                <p>Status</p>
                <p>{{ weather.weathercode }}</p>
            </div>
        
            <div class="weather_item">
                <p class="weather_icon">༄</p>
                <p>Wind Speed</p>
                <p>{{ weather.windspeed }} km/h</p>
            </div>
        
            <div class="weather_item">
                <p class="weather_icon">🧭</p>
                <p>Wind Direction</p>
                <p>{{ weather.winddirection }}°</p>
            </div>
        </section>

        <section id="hourly_forecast">
            <h3>2-Day Hourly Weather Forecast</h3>
            <section id="hourly_container">
                {% for index, row in hourly.iterrows() %}
                    <div class="hourly_item">
                        <p class="time">{{ row['time'] }}</p>
                        <p class="temp" title="Temperature">&nbsp🌡 {{ row['temperature_2m'] }}°C</p>
                        <p class="precipitation" title="Precipitation">💧 {{ row['precipitation'] }}mm</p>
                        <p class ="precipitation" title="Chance of Precipitation">☔ {{ row['precipitation_probability'] }}%</p>
                        <p class ="humidity" title="Humidity">🌫️ {{ row['relativehumidity_2m'] }}%</p>
                        <p class="weather_status">{{ row['weathercode'] }}</p>
                    </div>
                {% endfor %}
            </section>
        </section>

        <section id="daily_forecast">
            <h3>5-Day Weather Forecast</h3>
            <section id="daily_container">
                {% for index, row in daily.iterrows() %}
                    <div class="daily_item">
                        <p class="time">{{ row['time'] }}</p>
                        <p class="temp" title="Highest Temperature">↑🌡 {{ row['temperature_2m_max'] }}°C</p>
                        <p class="temp" title="Lowest Temperature">↓🌡 {{ row['temperature_2m_min'] }}°C</p>
                        <p class="precipitation" title="Precipitation">💧 {{ row['precipitation_sum'] }}mm</p>
                        <p class="weather_status">{{ row['weathercode'] }}</p>
                    </div>
                {% endfor %}
            </section>
        </section>        
    </section>


{% endblock %}